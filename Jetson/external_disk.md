# 1. Подготовка внешнего диска
Подключите внешний диск (USB SSD/HDD или NVMe в слот M.2 – в зависимости от вашей аппаратной конфигурации).
Создайте раздел на внешнем диске (через `fdisk` или parted) и отформатируйте в ext4. Предположим, что внешний диск определяется как `/dev/sda`, а нужный раздел – `/dev/sda1`.

``` bash
sudo fdisk /dev/sda
sudo mkfs.ext4 /dev/sda1
```

Создайте временную точку монтирования и смонтируйте:
``` bash
sudo mkdir /mnt/external_root
sudo mount /dev/sda1 /mnt/external_root
```
# 2. Копирование текущего rootfs на внешний диск
Чтобы перенести текущую корневую файловую систему на новый раздел, нужно скопировать содержимое «/» на `/mnt/external_root`. При этом важно максимально сохранить права, владельцев, спецфайлы и т. д. Удобно использовать rsync с опциями, сохраняющими всё как есть:

``` bash
sudo rsync -axHAWXS --numeric-ids / /mnt/external_root
```
Расшифровка ключей:

`-a` (архивный режим: рекурсивно, сохранение прав, меток времени и т. д.)

`-x` (не переходить на другие файловые системы, т. е. не копировать смонтированные в /mnt/external_root или сетевые ресурсы)

`-H` (сохранять жёсткие ссылки)

`-A` (сохранять ACL)

`-W` (копировать целиком, иногда ускоряет большие файлы)

`-X` (сохранять xattr — расширенные атрибуты)

`--numeric-ids` (не отображать UID/GID в имена, а копировать «как есть»).

При таком копировании могут проскакивать предупреждения об отдельных псевдофайлах, это нормально (например, `/proc`, `/sys` и т.п. не являются настоящими файлами). В целом `rsync` пропустит их корректно.

Обратите внимание, что папки `/proc`, `/sys`, `/dev` и т. д. монтируются динамически, поэтому фактически скопируются только «пустые» каталоги, что нам и нужно.

# 3. Настройка нового root: `etc/fstab`
Когда вы будете грузиться с нового root, он станет «/». Соответственно, в файле `/etc/fstab` на новом диске пути должны быть прописаны с учётом, что этот раздел будет корневым.

Откройте `/mnt/external_root/etc/fstab`:
``` bash
sudo nano /mnt/external_root/etc/fstab
```
Найдите (или добавьте) строку, которая будет описывать корневой раздел. Например:
``` bash
UUID=xxxx-xxxx-xxxx  /  ext4  defaults  0  1
```
Или:
``` bash 
/dev/sda1 / ext4 defaults 0 1
``` 
UUID можно узнать через `blkid /dev/sda1`.

Убедитесь, что в качестве точки монтирования указан "/", а не `/mnt/external_root`.

Старую запись для корневого раздела eMMC (обычно `/dev/mmcblk0p1` или что-то похожее) можно либо закомментировать, либо удалить.
Таким образом, когда ядро будет читать `fstab` при загрузке с нового диска, оно будет знать, что "/" — это именно `/dev/sda1`.

# 4. Правка `extlinux.conf` (загрузочные параметры)
На Jetson TX2 (L4T) обычно используется `extlinux` (по сути вариант syslinux). Конфигурационный файл `extlinux.conf` хранится в `/boot/extlinux/` на том разделе, откуда загружается ядро. Как правило, при стандартной установке, это папка `/boot/extlinux` во внутренней eMMC.
Нужно отредактировать строчку APPEND, чтобы ядро при запуске монтировало `root` с внешнего носителя.

Откройте `extlinux.conf` во внутренней памяти (eMMC). Обычно путь:

``` bash
sudo nano /boot/extlinux/extlinux.conf
```
Найдите (или продублируйте) секцию, которая выглядит примерно так:

``` plaintext
LABEL primary
  MENU LABEL primary kernel
  LINUX /boot/Image
  INITRD /boot/initrd
  APPEND ${cbootargs} root=/dev/mmcblk0p1 rw rootwait
```
Или иногда `root=/dev/mmcblk0p1` может выглядеть как `root=PARTUUID=....`

Замените `root=/dev/mmcblk0p1` на что-то вроде:

``` bash
root=/dev/sda1 rw rootwait
```
Либо используйте `UUID=` или `PARTUUID=`(**У НАС НЕ СРАБОТАЛО**), если удобнее. Главное — указать, что корень теперь на `/dev/sda1`.

Сохраните изменения.

Чтобы подстраховаться, можно скопировать целую секцию LABEL primary и сделать новую секцию LABEL external, где указать `root=/dev/sda1`. Тогда при загрузке вы сможете выбрать соответствующий пункт меню и проверить, что всё работает, не затирая «старую» конфигурацию (**НЕ ПРОВЕРЕНО**).

Иногда ядро инициализирует USB-устройства чуть медленнее, и тогда рекомендуется добавить параметр `rootdelay=5` (или 10) в `APPEND`, чтобы у ядра было время «увидеть» USB-диск до монтирования root. Это полезно, если при загрузке система ругается, что не находит `/dev/sda1`. Например:

``` bash
APPEND ${cbootargs} root=/dev/sda1 rw rootwait rootdelay=5
```

# 5. Проверка и загрузка
Убедитесь, что вы не размонтировали `/mnt/external_root` раньше времени. Если размонтировали — ничего страшного, если rsync уже завершился успешно.
Перезагрузите Jetson TX2:

``` bash
sudo reboot
``` 
Если вы добавили новый пункт в `extlinux.conf`, при запуске (когда появляется меню загрузчика) выберите соответствующую опцию.
После загрузки проверьте:

``` bash
df -h
```

Убедитесь, что корень действительно `/dev/sda1`.